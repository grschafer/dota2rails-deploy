---
# not using gem ansible module b/c gem binary won't be where it expects
# see https://groups.google.com/forum/#!topic/ansible-project/bcpYT13yao8
- name: install global gems
  command: "{{ ruby_bin }}/gem install {{ item }} chdir=~"
  #gem: name={{ item }} state=latest
  sudo: yes
  with_items:
    - bundler

- name: ensure repo exists at {{ deploy_path }}
  stat: path={{ deploy_path }}
  register: app_path

- fail: msg="Webapp repo was not synced to the server/VM"
  sudo: yes
  when: app_path.stat.isdir is not defined or app_path.stat.isdir == false

- name: give repo to {{ deploy_user }}
  sudo: yes
  file:
    path={{ deploy_path }}
    owner={{ deploy_user }}
    recurse=yes

- name: copy templated config
  template: src=application.yml.rb.j2 dest={{ deploy_path }}/config/application.yml
